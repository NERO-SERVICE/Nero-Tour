<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Config Debug - Seoul Explorer</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #00ff00; }
        .error { color: #ff4444; }
        .success { color: #44ff44; }
        .warning { color: #ffaa44; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #333; }
        pre { background: #222; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Seoul Explorer - Configuration Debug</h1>
    
    <div class="section">
        <h2>üìç Environment Information</h2>
        <div id="envInfo"></div>
    </div>
    
    <div class="section">
        <h2>üîë API Key Status</h2>
        <div id="apiKeyStatus"></div>
    </div>
    
    <div class="section">
        <h2>üó∫Ô∏è Google Maps API Test</h2>
        <div id="mapsTest"></div>
        <button onclick="testMapsAPI()" style="padding: 10px; margin: 10px 0;">Test Maps API</button>
    </div>
    
    <div class="section">
        <h2>üìä Full Config</h2>
        <pre id="fullConfig"></pre>
    </div>

    <!-- Load config -->
    <script src="src/config/config.js"></script>
    
    <script>
        function updateStatus(elementId, content, className = '') {
            const element = document.getElementById(elementId);
            element.innerHTML = content;
            element.className = className;
        }
        
        function checkEnvironment() {
            const buildInfo = window.BUILD_INFO || {};
            const envContent = `
                <p><strong>Environment:</strong> <span class="${buildInfo.environment === 'netlify' ? 'success' : 'warning'}">${buildInfo.environment || 'unknown'}</span></p>
                <p><strong>Source:</strong> ${buildInfo.source || 'unknown'}</p>
                <p><strong>Timestamp:</strong> ${buildInfo.timestamp || 'unknown'}</p>
                <p><strong>Version:</strong> ${buildInfo.version || 'unknown'}</p>
            `;
            updateStatus('envInfo', envContent);
        }
        
        function checkAPIKey() {
            const config = window.CONFIG || {};
            const apiKey = config.GOOGLE_MAPS_API_KEY;
            
            let status = '';
            let className = '';
            
            if (!apiKey) {
                status = '<p class="error">‚ùå API Key not found</p>';
                className = 'error';
            } else if (apiKey.length < 20) {
                status = '<p class="error">‚ùå API Key too short</p>';
                className = 'error';
            } else if (apiKey.includes('NOT_SET') || apiKey.includes('YOUR_API') || apiKey.includes('example')) {
                status = '<p class="error">‚ùå API Key is placeholder/example value</p>';
                className = 'error';
            } else if (!apiKey.startsWith('AIza')) {
                status = '<p class="error">‚ùå API Key format invalid (should start with AIza)</p>';
                className = 'error';
            } else {
                status = '<p class="success">‚úÖ API Key looks valid</p>';
                className = 'success';
            }
            
            status += `
                <p><strong>Length:</strong> ${apiKey?.length || 0}</p>
                <p><strong>Preview:</strong> ${apiKey ? apiKey.substring(0, 15) + '...' : 'none'}</p>
                <p><strong>Starts with AIza:</strong> ${apiKey?.startsWith('AIza') ? '‚úÖ' : '‚ùå'}</p>
            `;
            
            updateStatus('apiKeyStatus', status, className);
        }
        
        function testMapsAPI() {
            const config = window.CONFIG || {};
            const apiKey = config.GOOGLE_MAPS_API_KEY;
            
            if (!apiKey || apiKey.length < 20) {
                updateStatus('mapsTest', '<p class="error">‚ùå Cannot test - invalid API key</p>', 'error');
                return;
            }
            
            updateStatus('mapsTest', '<p class="warning">üîÑ Testing Maps API...</p>', 'warning');
            
            const testUrl = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places`;
            
            fetch(testUrl)
                .then(response => {
                    let result = `<p><strong>Status:</strong> ${response.status}</p>`;
                    result += `<p><strong>Status Text:</strong> ${response.statusText}</p>`;
                    result += `<p><strong>Headers:</strong></p><pre>${JSON.stringify([...response.headers.entries()], null, 2)}</pre>`;
                    
                    if (response.status === 200) {
                        result = '<p class="success">‚úÖ Maps API accessible</p>' + result;
                        updateStatus('mapsTest', result, 'success');
                    } else if (response.status === 403) {
                        result = '<p class="error">‚ùå 403 Forbidden - Check domain restrictions in Google Cloud Console</p>' + result;
                        updateStatus('mapsTest', result, 'error');
                    } else {
                        result = '<p class="error">‚ùå API request failed</p>' + result;
                        updateStatus('mapsTest', result, 'error');
                    }
                })
                .catch(error => {
                    updateStatus('mapsTest', `<p class="error">‚ùå Network error: ${error.message}</p>`, 'error');
                });
        }
        
        function showFullConfig() {
            const config = window.CONFIG || {};
            const buildInfo = window.BUILD_INFO || {};
            
            const fullConfig = {
                BUILD_INFO: buildInfo,
                CONFIG: {
                    ...config,
                    GOOGLE_MAPS_API_KEY: config.GOOGLE_MAPS_API_KEY ? 
                        config.GOOGLE_MAPS_API_KEY.substring(0, 15) + '...[MASKED]' : 
                        'NOT_FOUND'
                }
            };
            
            document.getElementById('fullConfig').textContent = JSON.stringify(fullConfig, null, 2);
        }
        
        // Run checks when page loads
        document.addEventListener('DOMContentLoaded', () => {
            checkEnvironment();
            checkAPIKey();
            showFullConfig();
        });
    </script>
</body>
</html>